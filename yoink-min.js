var YOINK=(function(){var Module=function(deps,f){this.deps=deps;this.func=f};var defaultInterpreters={json:function(text){return JSON.parse(text)},js:function(text,loader,callback){var f=eval("(function () {"+text+"})");var x=f();if(x&&x.constructor===Module){if(callback){loader.getResources(x.deps,function(){callback(x.func.apply(null,arguments))})}else{return x.func.apply(null,loader.getResourcesSync(x.deps))}}else{if(callback){callback(x)}else{return x}}},};var ResourceLoader=function(base,cache,interpreters){this.base=base;this.cache=cache||{};this.interpreters=interpreters||defaultInterpreters;return this};ResourceLoader.prototype={interpret:function(rsc,url,f,callback){if(!f){var ext=url.substring(url.lastIndexOf(".")+1,url.length).toLowerCase();f=this.interpreters[ext]}if(f){if(f.length==1){rsc=f(rsc)}else{var base=url.substring(0,url.lastIndexOf("/"));var subloader=new ResourceLoader(base,this.cache,this.interpreters);if(callback){return f(rsc,subloader,callback)}else{rsc=f(rsc,subloader)}}}if(callback){callback(rsc)}else{return rsc}},resolve:function(url){var p=url.path||url;var f=url.interpreter||null;if(this.base!==undefined&&p[0]!=="/"&&p.indexOf("://")===-1){p=this.base+"/"+p}return{path:p,interpreter:f}},getResourceSync:function(url){url=this.resolve(url);var rsc=this.cache[url.path];if(rsc===undefined){var req=new XMLHttpRequest();req.open("GET",url.path,false);req.send();rsc=this.interpret(req.responseText,url.path,url.interpreter);this.cache[url.path]=rsc}return rsc},getResourcesSync:function(urls){var rscs=[];var len=urls.length;for(var i=0;i<len;i++){rscs[i]=this.getResourceSync(urls[i])}return rscs},getResource:function(url,callback){url=this.resolve(url);var rsc=this.cache[url.path];if(rsc===undefined){var req=new XMLHttpRequest();var loader=this;req.onreadystatechange=function(){if(req.readyState===4){loader.interpret(req.responseText,url.path,url.interpreter,function(rsc){loader.cache[url.path]=rsc;callback(rsc)})}};req.open("GET",url.path,true);req.send()}else{setTimeout(function(){callback(rsc)},0)}},getResources:function(urls,callback){var rscs=[];var cnt=0;var len=urls.length;var mkHandler=function(i){return function(rsc){rscs[i]=rsc;cnt++;if(cnt===len){callback.apply(null,rscs)}}};for(var i=0;i<len;i++){this.getResource(urls[i],mkHandler(i))}},};function resourceLoader(base,cache,interpreters){return new ResourceLoader(base,cache,interpreters)}function module(deps,f){return new Module(deps,f)}var mkYoink=function(loader){var yoink=function(url,f){return loader.getResourceSync({path:url,interpreter:f})};yoink.loaded=loader.cache;yoink.interpreters=loader.interpreters;yoink.json=defaultInterpreters.json;yoink.javascript=defaultInterpreters.js;return yoink};return{resourceLoader:resourceLoader,module:module,interpreters:defaultInterpreters,yoink:mkYoink(resourceLoader()),}})();var yoink=YOINK.yoink;