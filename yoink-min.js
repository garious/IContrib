var YOINK=(function(){var yoinkMod=function(mod,yoink,callback){if(mod&&mod.deps&&mod.callback){yoink(mod.deps,function(){var m=mod.callback.apply(null,arguments);yoinkMod(m,yoink,callback)})}else{callback(mod)}};var defaultInterpreters={json:function(text){return JSON.parse(text)},js:function(text,yoink,callback){var f=eval("(function (baseUrl) {"+text+"})");var mod=f(yoink.base);yoinkMod(mod,yoink,callback)},};var clone=function(o1){var o2={};for(k in o1){o2[k]=o1[k]}return o2};var ResourceLoader=function(base,cache,interpreters){this.base=base||"";this.cache=cache||{};this.interpreters=interpreters||clone(defaultInterpreters);return this};ResourceLoader.prototype={interpret:function(rsc,url,interpreter,getResources,callback){if(!interpreter){var ext=url.substring(url.lastIndexOf(".")+1,url.length).toLowerCase();interpreter=this.interpreters[ext]||function(x){return x}}if(interpreter.length===1){callback(interpreter(rsc))}else{var base=url.substring(0,url.lastIndexOf("/"));var subloader=new ResourceLoader(base,this.cache,this.interpreters);var yoink=function(urls,f){return getResources.call(subloader,urls,f)};yoink.base=base;interpreter(rsc,yoink,callback)}},resolve:function(url){var p=url.path||url;var f=url.interpreter||null;if(this.base!==""&&p[0]!=="/"&&p.indexOf("://")===-1){p=this.base+"/"+p}p=p.replace(/[^/]+[/]\.\.[/]/g,"");return{path:p,interpreter:f}},getFile:function(path,callback){var req=new XMLHttpRequest();req.onreadystatechange=function(){if(req.readyState===4){callback(req.responseText)}};req.open("GET",path,true);req.send()},getResources:function(urls,callback){var rscs=[];var cnt=0;var len=urls.length;var getResources=function(us,f){this.getResources(us,f)};var loader=this;var onInterpreted=function(i,files){i++;while(i<len&&files[i]===null){i++}if(i===len){callback.apply(null,rscs)}else{interpretFile(i,files)}};var mkOnInterpreted=function(p,i,files){return function(rsc){if(rsc===undefined){rsc=null}rscs[i]=rsc;loader.cache[p]=rsc;onInterpreted(i,files)}};var interpretFile=function(i,files){var u=urls[i];console.log("yoink: interpreting '"+urls[i].path+"'");loader.interpret(files[i],u.path,u.interpreter,getResources,mkOnInterpreted(u.path,i,files))};var onDownloaded=function(files){cnt++;if(cnt===len){onInterpreted(-1,files)}};var mkOnDownloaded=function(i,files){return function(str){files[i]=str;onDownloaded(files)}};var download=function(i,files){urls[i]=loader.resolve(urls[i]);var p=urls[i].path;var rsc=loader.cache[p];if(rsc===undefined){loader.getFile(p,mkOnDownloaded(i,files))}else{files[i]=null;rscs[i]=rsc;onDownloaded(files)}};var files=[];for(var i=0;i<len;i++){download(i,files)}},};function resourceLoader(base,cache,interpreters){return new ResourceLoader(base,cache,interpreters)}return{resourceLoader:resourceLoader,interpreters:defaultInterpreters,}})();