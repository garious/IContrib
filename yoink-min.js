var YOINK=(function(){var defaultInterpreters={json:function(text){return JSON.parse(text)},js:function(text,loader){var f=eval("(function (yoink, loader) {"+text+"})");return f(mkYoink(loader),loader)},};function ResourceLoader(base,cache,interpreters){this.base=base;this.cache=cache||{};this.interpreters=interpreters||defaultInterpreters;return this}ResourceLoader.prototype.interpret=function(rsc,url,f){if(!f){var ext=url.substring(url.lastIndexOf(".")+1,url.length).toLowerCase();f=this.interpreters[ext]}if(f){if(f.length==1){rsc=f(rsc)}else{var base=url.substring(0,url.lastIndexOf("/"));var subloader=new ResourceLoader(base,this.cache,this.interpreters);rsc=f(rsc,subloader)}}return rsc};ResourceLoader.prototype.resolve=function(url){if(this.base!==undefined&&url[0]!=="/"&&url.indexOf("://")===-1){url=this.base+"/"+url}return url};ResourceLoader.prototype.sync=function(url,f){url=this.resolve(url);var rsc=this.cache[url];if(rsc===undefined){var req=new XMLHttpRequest();req.open("GET",url,false);req.send();rsc=this.interpret(req.responseText,url,f);this.cache[url]=rsc}return rsc};ResourceLoader.prototype.async=function(url,f,callback){url=this.resolve(url);var rsc=this.cache[url];if(rsc===undefined){var req=new XMLHttpRequest();var loader=this;req.onreadystatechange=function(){if(req.readyState===4){rsc=loader.interpret(req.responseText,url,f);loader.cache[url]=rsc;callback(rsc)}};req.open("GET",url,true);req.send()}else{setTimeout(function(){callback(rsc)},0)}};function createResourceLoader(base,cache,interpreters){return new ResourceLoader(base,cache,interpreters)}function mkYoink(loader){var yoink=function(url,f){return loader.sync(url,f)};yoink.loaded=loader.cache;yoink.interpreters=loader.interpreters;yoink.json=defaultInterpreters.json;yoink.javascript=defaultInterpreters.js;return yoink}return{createResourceLoader:createResourceLoader,interpreters:defaultInterpreters,yoink:mkYoink(createResourceLoader()),}})();var yoink=YOINK.yoink;